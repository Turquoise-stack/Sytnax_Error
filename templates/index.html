<!DOCTYPE html>
<!-- 
TODO:
- panel poboczny z rzeczami. 
- branie rzeczy z templatek
- 

-->
<html>

<head>
    <meta charset="utf-8">
    <title>Change a map's style configuration property</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <script src='https://unpkg.com/suncalc@1.8.0/suncalc.js'></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <style>
        .map-overlay {
            font:
                12px/20px 'Helvetica Neue',
                Arial,
                Helvetica,
                sans-serif;
            position: absolute;
            width: 200px;
            top: 0;
            left: 0;
            padding: 10px;
        }

        .map-overlay .map-overlay-inner {
            background-color: #fff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .map-overlay-inner fieldset {
            display: flex;
            justify-content: space-between;
            border: none;
        }

        .map-overlay-inner label {
            font-weight: bold;
            margin-right: 10px;
        }

        .map-overlay-inner .select-fieldset {
            display: block;
        }

        .map-overlay-inner .select-fieldset label {
            display: block;
            margin-bottom: 5px;
        }

        .map-overlay-inner .select-fieldset select {
            width: 100%;
        }
    </style>

    <div id="map"></div>

    <div class="map-overlay top">
        <div class="map-overlay-inner">
            <!--
            <fieldset class="select-fieldset">
                <label>Select light preset</label>
                <select id="lightPreset" name="lightPreset">
                    <option value="dawn">Dawn</option>
                    <option value="day" selected="">Day</option>
                    <option value="dusk">Dusk</option>
                    <option value="night">Night</option>
                </select>
            </fieldset>
        -->
            <fieldset>
                <label for="showPlaceLabels">Show place labels</label>
                <input type="checkbox" id="showPlaceLabels" checked="">
            </fieldset>
            <fieldset>
                <label for="showPointOfInterestLabels">Show POI labels</label>
                <input type="checkbox" id="showPointOfInterestLabels" checked="">
            </fieldset>
            <fieldset>
                <label for="showRoadLabels">Show road labels</label>
                <input type="checkbox" id="showRoadLabels" checked="">
            </fieldset>
            <fieldset>
                <label for="showTransitLabels">Show transit labels</label>
                <input type="checkbox" id="showTransitLabels" checked="">
            </fieldset>
            <div id="slider">
                <input type="range" id="time-slider" min="0" max="23" step="1" value="12">
                <label for="time-slider">Hour: <span id="hour">12</span>:00</label>
            </div>

        </div>
    </div>

    <script>
        const presets = ['dawn', 'day', 'dusk', 'night']
        var curPr = 0
        const slider = document.getElementById('time-slider');
        const hourLabel = document.getElementById('hour');
        function rotateCamera(timestamp) {
            // clamp the rotation between 0 -360 degrees
            // Divide timestamp by 100 to slow rotation to ~10 degrees / sec
            map.rotateTo((timestamp / 100) % 360, { duration: 0 });
            // Request the next frame of the animation.
            requestAnimationFrame(rotateCamera);
        }
        mapboxgl.accessToken = '';
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            //center: [21.045303247847162, 52.25619693265087], // starting position [lng, lat] - google campus
            center: [21.006037913053945,52.23187082719522 ], // starting position [lng, lat] - pkin
            //zoom: 18.1, // starting zoom
            zoom: 16.1, // starting zoom for pkin
            pitch: 62, // starting pitch
            bearing: -20 // starting bearing
        });

        rotateCamera(0)
        setInterval(()=>{
            curPr = (curPr + 1) % presets.length
            console.log(curPr)
            map.setConfigProperty('basemap', 'lightPreset',presets[curPr])
        }, 5000)
//        document
//            .getElementById('lightPreset')
//            .addEventListener('change', function () {
//                map.setConfigProperty('basemap', 'lightPreset', this.value);
//            });
//
        document
            .querySelectorAll('.map-overlay-inner input[type="checkbox"]')
            .forEach((checkbox) => {
                checkbox.addEventListener('change', function () {
                    map.setConfigProperty('basemap', this.id, this.checked);
                });
            });

        map.on('load', () => {
            slider.addEventListener('input', (e) => {
                const hour = e.target.value;
            });

        });

        // Example function to get shadow color based on hour
        function getShadowColor(hour) {
            // Simple example: darker color for night hours
            if (hour >= 6 && hour <= 18) {
                return '#aaa'; // Daytime color
            } else {
                return '#555'; // Nighttime color
            }
        }
        function calculateSunAzimuth(lat, lon, date) {
            const rad = Math.PI / 180;
            const deg = 180 / Math.PI;

            // Convert latitude and longitude to radians
            const latRad = lat * rad;
            const lonRad = lon * rad;

            // Calculate the Julian date
            const julianDate = (date / 86400000) + 2440587.5;

            // Calculate the number of days since J2000.0
            const d = julianDate - 2451545.0;

            // Calculate the mean longitude of the sun
            const L = (280.46 + 0.9856474 * d) % 360;

            // Calculate the mean anomaly of the sun
            const g = (357.528 + 0.9856003 * d) % 360;

            // Calculate the ecliptic longitude of the sun
            const lambda = L + 1.915 * Math.sin(g * rad) + 0.02 * Math.sin(2 * g * rad);

            // Calculate the obliquity of the ecliptic
            const epsilon = 23.439 - 0.0000004 * d;

            // Calculate the right ascension of the sun
            const alpha = Math.atan2(Math.cos(epsilon * rad) * Math.sin(lambda * rad), Math.cos(lambda * rad)) * deg;

            // Calculate the declination of the sun
            const delta = Math.asin(Math.sin(epsilon * rad) * Math.sin(lambda * rad)) * deg;

            // Calculate the local sidereal time
            const GMST = (18.697374558 + 24.06570982441908 * d) % 24;
            const LMST = (GMST + lon / 15) % 24;
            const H = (LMST * 15 - alpha) % 360;

            // Calculate the azimuth
            const azimuth = Math.atan2(Math.sin(H * rad), Math.cos(H * rad) * Math.sin(latRad) - Math.tan(delta * rad) * Math.cos(latRad)) * deg;
            return (azimuth + 360) % 360;
        }
    </script>

</body>

</html>